{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 92, "column": 0}, "map": {"version":3,"sources":["file:///C:/myprojects/nextjs_project/chai_or_code/project_mongodb/mistrymess/src/lib/dbcon.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\nrequire('dotenv').config();\r\n \r\ntype connectionObject = {\r\n    isConnected?: number\r\n}\r\n\r\nconst connection: connectionObject = {}\r\n\r\nasync function dbConnect(): Promise<void> {\r\n    if(connection.isConnected){\r\n        console.log(\"Already connected to databass\")\r\n        return\r\n    }\r\n\r\n    try {\r\n    const db = await mongoose.connect(process.env.mongoDB_URI || '', {})\r\n    connection.isConnected = db.connections[0].readyState\r\n    console.log('db connected succefull ')\r\n    } catch (error) {\r\n        console.log(\"databass connetion falid\",error)\r\n        process.exit(1)\r\n    }\r\n}\r\n\r\nexport default dbConnect"],"names":[],"mappings":";;;AAAA;;AACA,8FAAkB,MAAM;AAMxB,MAAM,aAA+B,CAAC;AAEtC,eAAe;IACX,IAAG,WAAW,WAAW,EAAC;QACtB,QAAQ,GAAG,CAAC;QACZ;IACJ;IAEA,IAAI;QACJ,MAAM,KAAK,MAAM,yGAAA,CAAA,UAAQ,CAAC,OAAO,CAAC,QAAQ,GAAG,CAAC,WAAW,IAAI,IAAI,CAAC;QAClE,WAAW,WAAW,GAAG,GAAG,WAAW,CAAC,EAAE,CAAC,UAAU;QACrD,QAAQ,GAAG,CAAC;IACZ,EAAE,OAAO,OAAO;QACZ,QAAQ,GAAG,CAAC,4BAA2B;QACvC,QAAQ,IAAI,CAAC;IACjB;AACJ;uCAEe","debugId":null}},
    {"offset": {"line": 120, "column": 0}, "map": {"version":3,"sources":["file:///C:/myprojects/nextjs_project/chai_or_code/project_mongodb/mistrymess/src/model/user.ts"],"sourcesContent":["import mongoose, {Schema, Document} from 'mongoose';\r\n\r\nexport interface Message extends Document {\r\n    content: string;\r\n    createAt: Date\r\n}\r\n\r\n\r\nconst MessageSchema: Schema<Message> = new Schema({\r\n    content:{\r\n        type : String,\r\n        required: true\r\n    },\r\n    createAt:{\r\n        type:Date,\r\n        required: true,\r\n        default: Date.now\r\n    }\r\n})\r\n\r\n\r\nexport interface User extends Document {\r\n    username : string,\r\n    email : string,\r\n    password : string,\r\n    verifycode : string,\r\n    verifycodeExpiry : Date,\r\n    isVerified: boolean,\r\n    isAcceptingMessage:boolean,\r\n    message : Message[]\r\n}\r\n\r\n\r\nconst UserSchema: Schema<User> = new Schema({\r\n    username:{\r\n        type : String,\r\n        required: [true, \"Username is required\"],\r\n        trim: true,\r\n        unique: true\r\n    },\r\n   \r\n    email:{\r\n        type : String,\r\n        required: [true, \"email is required\"],\r\n        unique: true,\r\n        match:[/.+\\@.+\\..+/,\"plase use a valid email address\"]\r\n    },\r\n\r\n    password:{\r\n        type : String,\r\n        required: [true, \"password is required\"], \r\n    },\r\n\r\n    vrifycode:{\r\n        type : String,\r\n        required: [true, \"vrify code is required\"], \r\n    },\r\n    vrifycodeExpiry:{\r\n        type : Date,\r\n        required: [true, \"vrify code Expiry is required\"], \r\n    },\r\n\r\n     isVerified:{\r\n        type : Boolean,\r\n        default: false,\r\n    },\r\n\r\n     isAcceptingMessage:{\r\n        type : Boolean,\r\n        default: true\r\n    },\r\n\r\n      message: [MessageSchema]\r\n})\r\n\r\n\r\nconst UserModel = (mongoose.models.User as mongoose.Model<User>) || mongoose.model(\"User\" , UserSchema)\r\n\r\nexport default UserModel;"],"names":[],"mappings":";;;AAAA;;AAQA,MAAM,gBAAiC,IAAI,yGAAA,CAAA,SAAM,CAAC;IAC9C,SAAQ;QACJ,MAAO;QACP,UAAU;IACd;IACA,UAAS;QACL,MAAK;QACL,UAAU;QACV,SAAS,KAAK,GAAG;IACrB;AACJ;AAeA,MAAM,aAA2B,IAAI,yGAAA,CAAA,SAAM,CAAC;IACxC,UAAS;QACL,MAAO;QACP,UAAU;YAAC;YAAM;SAAuB;QACxC,MAAM;QACN,QAAQ;IACZ;IAEA,OAAM;QACF,MAAO;QACP,UAAU;YAAC;YAAM;SAAoB;QACrC,QAAQ;QACR,OAAM;YAAC;YAAa;SAAkC;IAC1D;IAEA,UAAS;QACL,MAAO;QACP,UAAU;YAAC;YAAM;SAAuB;IAC5C;IAEA,WAAU;QACN,MAAO;QACP,UAAU;YAAC;YAAM;SAAyB;IAC9C;IACA,iBAAgB;QACZ,MAAO;QACP,UAAU;YAAC;YAAM;SAAgC;IACrD;IAEC,YAAW;QACR,MAAO;QACP,SAAS;IACb;IAEC,oBAAmB;QAChB,MAAO;QACP,SAAS;IACb;IAEE,SAAS;QAAC;KAAc;AAC9B;AAGA,MAAM,YAAY,AAAC,yGAAA,CAAA,UAAQ,CAAC,MAAM,CAAC,IAAI,IAA6B,yGAAA,CAAA,UAAQ,CAAC,KAAK,CAAC,QAAS;uCAE7E","debugId":null}},
    {"offset": {"line": 199, "column": 0}, "map": {"version":3,"sources":["file:///C:/myprojects/nextjs_project/chai_or_code/project_mongodb/mistrymess/src/lib/resend.ts"],"sourcesContent":["import { Resend } from 'resend';\r\n\r\nexport const resend = new Resend(\"re_atkjqBsk_MkiSn8ywnHtLoQMLvKUqHRRz\");"],"names":[],"mappings":";;;AAAA;;AAEO,MAAM,SAAS,IAAI,0IAAA,CAAA,SAAM,CAAC","debugId":null}},
    {"offset": {"line": 211, "column": 0}, "map": {"version":3,"sources":["file:///C:/myprojects/nextjs_project/chai_or_code/project_mongodb/mistrymess/email/VerificationEmail.tsx"],"sourcesContent":["import {\r\n    Html,\r\n    Head,\r\n    // Font,\r\n    Preview, \r\n    Heading, \r\n    Row,\r\n    Section,\r\n    Text,\r\n    // Button,\r\n} from \"@react-email/components\";\r\n\r\ninterface varificationEmailprops{\r\n    username: string;\r\n    otp: string;\r\n}\r\n\r\n\r\nexport default function varificationEmail({username, otp}:varificationEmailprops){\r\n    return(\r\n        <Html lang=\"en\" dir='ltr'>\r\n        <Head>\r\n            <title>Varification Code</title>\r\n        </Head>\r\n     \r\n        <Preview>Hear&apos;s your varification Code: {otp} </Preview>\r\n         <Section>\r\n            <Row>\r\n                <Heading>Hello {username}</Heading>\r\n            </Row>\r\n            <Row>\r\n                <Text>\r\n                    Thanks you for registering. Please use the following varification code to comlpete your registration\r\n                </Text>\r\n            </Row>\r\n            <Row>{otp}</Row>\r\n            <Row>\r\n                <Text>\r\n                    If you did not request this code, please ignore this email\r\n                </Text></Row>\r\n         </Section>\r\n\r\n        </Html>\r\n    );\r\n}"],"names":[],"mappings":";;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;AAkBe,SAAS,kBAAkB,EAAC,QAAQ,EAAE,GAAG,EAAwB;IAC5E,qBACI,gPAAC,4JAAA,CAAA,OAAI;QAAC,MAAK;QAAK,KAAI;;0BACpB,gPAAC,4JAAA,CAAA,OAAI;0BACD,cAAA,gPAAC;8BAAM;;;;;;;;;;;0BAGX,gPAAC,+JAAA,CAAA,UAAO;;oBAAC;oBAAqC;oBAAI;;;;;;;0BACjD,gPAAC,+JAAA,CAAA,UAAO;;kCACL,gPAAC,2JAAA,CAAA,MAAG;kCACA,cAAA,gPAAC,+JAAA,CAAA,UAAO;;gCAAC;gCAAO;;;;;;;;;;;;kCAEpB,gPAAC,2JAAA,CAAA,MAAG;kCACA,cAAA,gPAAC,4JAAA,CAAA,OAAI;sCAAC;;;;;;;;;;;kCAIV,gPAAC,2JAAA,CAAA,MAAG;kCAAE;;;;;;kCACN,gPAAC,2JAAA,CAAA,MAAG;kCACA,cAAA,gPAAC,4JAAA,CAAA,OAAI;sCAAC;;;;;;;;;;;;;;;;;;;;;;;AAOtB","debugId":null}},
    {"offset": {"line": 323, "column": 0}, "map": {"version":3,"sources":["file:///C:/myprojects/nextjs_project/chai_or_code/project_mongodb/mistrymess/src/helpers/sendVerificationEmail.ts"],"sourcesContent":["import { resend } from \"@/lib/resend\";\r\nimport varificationEmail from '../../email/VerificationEmail';\r\nimport { ApiRespones } from \"@/types/ApiRespones\";\r\n\r\nexport async function sendVarificationEmail(\r\n    email : string,\r\n    username: string,\r\n    verifyCode: string\r\n):Promise<ApiRespones>{\r\n\r\n    try {\r\n        await resend.emails.send({\r\n            from: 'onboarding@resend.dev',\r\n            to: email,\r\n            subject: 'sms sender | verification code',\r\n            react: varificationEmail({username, otp: verifyCode}),\r\n        });\r\n        return {success: true, message :\"verification email send successfully\"}\r\n    } catch (emailError) {\r\n        console.error(\"Error sending verification code\", emailError)\r\n        return {success: false, message :\"Failed to send verification email\"}\r\n    }\r\n}"],"names":[],"mappings":";;;AAAA;AACA;;;AAGO,eAAe,sBAClB,KAAc,EACd,QAAgB,EAChB,UAAkB;IAGlB,IAAI;QACA,MAAM,sHAAA,CAAA,SAAM,CAAC,MAAM,CAAC,IAAI,CAAC;YACrB,MAAM;YACN,IAAI;YACJ,SAAS;YACT,OAAO,CAAA,GAAA,6HAAA,CAAA,UAAiB,AAAD,EAAE;gBAAC;gBAAU,KAAK;YAAU;QACvD;QACA,OAAO;YAAC,SAAS;YAAM,SAAS;QAAsC;IAC1E,EAAE,OAAO,YAAY;QACjB,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO;YAAC,SAAS;YAAO,SAAS;QAAmC;IACxE;AACJ","debugId":null}},
    {"offset": {"line": 359, "column": 0}, "map": {"version":3,"sources":["file:///C:/myprojects/nextjs_project/chai_or_code/project_mongodb/mistrymess/src/app/api/sign-up/route.ts"],"sourcesContent":["import dbConnect from \"@/lib/dbcon\";\r\nimport UserModel from \"@/model/user\";\r\nimport bcrypt from \"bcryptjs\"\r\nimport { sendVarificationEmail } from \"@/helpers/sendVerificationEmail\";\r\n\r\n\r\nexport async function POST(request: Request) {\r\n    await dbConnect()\r\n\r\n\r\n    try {\r\n        const { username, email, password } = await request.json()\r\n\r\n        const existingUserVerifiedByusername = await UserModel.findOne({\r\n            username,\r\n            isVerified: true\r\n        })\r\n\r\n        if (existingUserVerifiedByusername) {\r\n            return Response.json(\r\n                {\r\n                    success: false,\r\n                    message: \"Username is Already Token\"\r\n                },\r\n                { status: 400 })\r\n        }\r\n\r\n\r\n        const existingUserByemail = await UserModel.findOne({ email })\r\n\r\n        const verifyCode = Math.floor(100000 + Math.random() * 900000).toString()\r\n\r\n\r\n        if (existingUserByemail) {\r\n            if (existingUserByemail.isVerified) {\r\n                return Response.json(\r\n                    {\r\n                        success: false,\r\n                        message: \"User already exit with this email\"\r\n                    },\r\n                    { status: 400 })\r\n            } else{\r\n                const hasedPassword = await bcrypt.hash(password, 10)\r\n                existingUserByemail.password = hasedPassword\r\n                existingUserByemail.verifycode = verifyCode\r\n                existingUserByemail.verifycodeExpiry = new Date(Date.now() + 3600000)   \r\n                await existingUserByemail.save()\r\n            }\r\n        } else {\r\n            const hasedPassword = await bcrypt.hash(password, 10)\r\n            const expiryDate = new Date()\r\n            expiryDate.setHours(expiryDate.getHours() + 1)\r\n\r\n            const newUser = new UserModel({\r\n                username,\r\n                email,\r\n                password: hasedPassword,\r\n                verifyCode,\r\n                vrifycodeExpiry: expiryDate,\r\n                isVerified: false,\r\n                isAcceptingMessage: true,\r\n                message: []\r\n            })\r\n\r\n            await newUser.save()\r\n\r\n        }\r\n\r\n        //send  verification email\r\n        const eamilResponse = await sendVarificationEmail(\r\n            email,\r\n            username,\r\n            verifyCode\r\n        )\r\n\r\n        if (!eamilResponse.success) {\r\n            return Response.json({\r\n                success: false,\r\n                message: eamilResponse.message\r\n            }, { status: 500 })\r\n        }\r\n\r\n        return Response.json({\r\n            success: true,\r\n            message: \"User Registered successfully.Please varify your email \"\r\n        }, { status: 201 })\r\n\r\n\r\n\r\n    } catch (error) {\r\n        console.error(\"Error registering user \", error)\r\n        return Response.json(\r\n            {\r\n                success: false,\r\n                message: \"Error registering user\"\r\n            },\r\n            { status: 500 })\r\n    }\r\n}"],"names":[],"mappings":";;;AAAA;AACA;AACA;AACA;;;;;AAGO,eAAe,KAAK,OAAgB;IACvC,MAAM,CAAA,GAAA,qHAAA,CAAA,UAAS,AAAD;IAGd,IAAI;QACA,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,MAAM,QAAQ,IAAI;QAExD,MAAM,iCAAiC,MAAM,sHAAA,CAAA,UAAS,CAAC,OAAO,CAAC;YAC3D;YACA,YAAY;QAChB;QAEA,IAAI,gCAAgC;YAChC,OAAO,SAAS,IAAI,CAChB;gBACI,SAAS;gBACT,SAAS;YACb,GACA;gBAAE,QAAQ;YAAI;QACtB;QAGA,MAAM,sBAAsB,MAAM,sHAAA,CAAA,UAAS,CAAC,OAAO,CAAC;YAAE;QAAM;QAE5D,MAAM,aAAa,KAAK,KAAK,CAAC,SAAS,KAAK,MAAM,KAAK,QAAQ,QAAQ;QAGvE,IAAI,qBAAqB;YACrB,IAAI,oBAAoB,UAAU,EAAE;gBAChC,OAAO,SAAS,IAAI,CAChB;oBACI,SAAS;oBACT,SAAS;gBACb,GACA;oBAAE,QAAQ;gBAAI;YACtB,OAAM;gBACF,MAAM,gBAAgB,MAAM,mIAAA,CAAA,UAAM,CAAC,IAAI,CAAC,UAAU;gBAClD,oBAAoB,QAAQ,GAAG;gBAC/B,oBAAoB,UAAU,GAAG;gBACjC,oBAAoB,gBAAgB,GAAG,IAAI,KAAK,KAAK,GAAG,KAAK;gBAC7D,MAAM,oBAAoB,IAAI;YAClC;QACJ,OAAO;YACH,MAAM,gBAAgB,MAAM,mIAAA,CAAA,UAAM,CAAC,IAAI,CAAC,UAAU;YAClD,MAAM,aAAa,IAAI;YACvB,WAAW,QAAQ,CAAC,WAAW,QAAQ,KAAK;YAE5C,MAAM,UAAU,IAAI,sHAAA,CAAA,UAAS,CAAC;gBAC1B;gBACA;gBACA,UAAU;gBACV;gBACA,iBAAiB;gBACjB,YAAY;gBACZ,oBAAoB;gBACpB,SAAS,EAAE;YACf;YAEA,MAAM,QAAQ,IAAI;QAEtB;QAEA,0BAA0B;QAC1B,MAAM,gBAAgB,MAAM,CAAA,GAAA,yIAAA,CAAA,wBAAqB,AAAD,EAC5C,OACA,UACA;QAGJ,IAAI,CAAC,cAAc,OAAO,EAAE;YACxB,OAAO,SAAS,IAAI,CAAC;gBACjB,SAAS;gBACT,SAAS,cAAc,OAAO;YAClC,GAAG;gBAAE,QAAQ;YAAI;QACrB;QAEA,OAAO,SAAS,IAAI,CAAC;YACjB,SAAS;YACT,SAAS;QACb,GAAG;YAAE,QAAQ;QAAI;IAIrB,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,2BAA2B;QACzC,OAAO,SAAS,IAAI,CAChB;YACI,SAAS;YACT,SAAS;QACb,GACA;YAAE,QAAQ;QAAI;IACtB;AACJ","debugId":null}}]
}